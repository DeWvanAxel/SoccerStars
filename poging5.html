<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title>hello phaser!</title>
        <script src="phaser.min.js"></script>

    </head>
    <body>

    <script type="text/javascript">



  var config = {
    type: Phaser.AUTO,
    width: 1200,
    height: 800,
    physics: {
        default: 'matter',
        matter: {
            gravity: { y: 0 },
            debug: true
        }
    },
    scene: {
        preload: preload,
        create: create,
        update: update
    }
    };

    var game = new Phaser.Game(config);
    var player1balls = Array();
    var player2balls = Array();

    var scoreLeft = 0;
    var scoreRight = 0;
    var scoreText;

function preload() {
    this.load.image('soepino', 'sprites/soepino.png');
    this.load.image('ambrosius', 'sprites/ambrosius.png');
    this.load.image('football', 'sprites/football.png');

    this.load.image('topwall', 'sprites/tb.png');
    this.load.image('bottomwall', 'sprites/tb.png');
    this.load.image('leftwall', 'sprites/lr.png');
    this.load.image('rightwall', 'sprites/lr.png');
    this.load.image('leftgoal', 'sprites/goal.png');
    this.load.image('rightgoal', 'sprites/goal.png');

    //game.load.image('disk', 'sprites/soepino.png');

}

function createBalls(playerballs, image, amountBalls,game,xOf, yOf) {
    for (var i = 0; i < amountBalls; i++) {
        playerball = game.matter.add.image(xOf[i],yOf[i], image).setBody({type:"circle", radius:37});
        playerball.setBounce(0.7).setFrictionAir(0.0175);
        playerballs.push(playerball);
    }
    return playerballs
}

function shoot(playerballs, playerNumber, angle, speed){
    if (speed > 15) {
        speed = 15
    }
    if (speed < 0) {
        speed = 0
    }
    x = Math.cos(angle * Math.PI/180) * speed;
    y = Math.sin(angle * Math.PI/180) * speed;
    playerballs[playerNumber].setVelocity(x,y);
}

var ball1;
var ball2;
var disk;

function create() {

    this.matter.world.setBounds();

    scoreText = this.add.text(16, 16, 'Score: 0 - 0', { fontSize: '32px', fill: '#FFFFFF' });


    // CREATE WORLD
    topwall = this.matter.add.image(600,75, 'topwall').setStatic(true);
    lefttopwall = this.matter.add.image(125,200, 'leftwall').setStatic(true);
    righttopwall = this.matter.add.image(1075,200, 'rightwall').setStatic(true);
    leftbottomwall = this.matter.add.image(125,600, 'leftwall').setStatic(true);
    rightbottomwall = this.matter.add.image(1075,600, 'rightwall').setStatic(true);
    bottomwall = this.matter.add.image(600,725, 'bottomwall').setStatic(true);
    leftgoal = this.matter.add.image(112,400, 'leftgoal').setStatic(true);
    rightgoal = this.matter.add.image(1088,400, 'rightgoal').setStatic(true);

    // CREATE PLAYERS
    ball = this.matter.add.image(600,400, 'football').setBody({type:"circle", radius:20});

     
    var xOf1 = [525,375,375,200,200];
    var yOf1 = [400,275,525,325,475];
    player1balls = createBalls(player1balls, 'soepino', 5, this, xOf1, yOf1);

    var xOf2 = [675,825,825,1000,1000];
    var yOf2 = [400,275,525,325,475];
    player2balls = createBalls(player2balls, 'ambrosius', 5, this, xOf2, yOf2);

    var [playerNumber,angle,speed] = play(ball, player1balls, player2balls, scoreRight, scoreLeft, "human")
    shoot(player2balls, playerNumber, angle, speed)




    this.matter.world.on("collisionstart", checkForGoals);
    leftgoal.on("goalscored", updateScoreAndReset);
    rightgoal.on("goalscored", updateScoreAndReset); 

}

function checkForGoals(event){
    pairs = event.pairs;
    for(var i =0; i < pairs.length; i++){
        if((pairs[i].bodyA.gameObject.name == "ball" && (pairs[i].bodyB.gameObject.name == "leftgoal" || pairs[i].bodyB.gameObject.name == "rightgoal")) || (pairs[i].bodyB.gameObject.name == "ball" && (pairs[i].bodyA.gameObject.name == "leftgoal" || pairs[i].bodyA.gameObject.name == "rightgoal"))){
            if(pairs[i].bodyA.gameObject.name == "leftgoal"){
                pairs[i].bodyA.gameObject.emit("goalscored", {scorer: "player 2"});
            }
            if(pairs[i].bodyB.gameObject.name == "leftgoal"){
                pairs[i].bodyB.gameObject.emit("goalscored", {scorer: "player 2"});
            }
            if(pairs[i].bodyA.gameObject.name == "rightgoal"){
                pairs[i].bodyA.gameObject.emit("goalscored", {scorer: "player 1"});
            }
            if(pairs[i].bodyB.gameObject.name == "rightgoal"){
                pairs[i].bodyB.gameObject.emit("goalscored", {scorer: "player 1"});
            }
        }
    }


}

function updateScoreAndReset(scorer){
    if (scorer == "player 1") {
        scoreLeft += 1
    }
    else {
        scoreRight += 1
    }
    scoreText.setText('Score: ' + scoreLeft + " - " + scoreRight);
}

function update () {


    //game.physics.arcade.collide(ball1, disk);
    //game.physics.arcade.collide(ball2, disk);
    
}

 function checkForGoals(pairs){
    //console.log(pairs);
    //if(object1.body.collisionFilter.category == goals){
    //    console.log("GOOOOOAAAAAAL!!!");
    //}


}

function play(ball, player1balls, player2balls, scoreRight, scoreLeft, settings){
    if (settings == "human") {
        playerNumber =1
        angle = 30
        speed = 3
    } else {
        playerNumber = 2
        angle = 70
        speed = 12
    }
    
    return [playerNumber,angle,speed]
}



    </script>

    </body>
</html>